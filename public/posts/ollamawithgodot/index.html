

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Use Ollama with Godot - Coosis&#39;s Blog</title>

  <meta name="description" content="What? You can have &ldquo;alive&rdquo; NPCs in your game?">
  <meta name="author" content="Coosis"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "",
    
    "url": "https:\/\/coosis.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/coosis.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/coosis.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/coosis.github.io\/posts\/ollamawithgodot\/",
          "name": "Use ollama with godot"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Coosis"
  },
  "headline": "Use Ollama with Godot",
  "description" : "What? You can have \u0026ldquo;alive\u0026rdquo; NPCs in your game?\n",
  "inLanguage" : "en",
  "wordCount":  602 ,
  "datePublished" : "2023-12-08T15:50:38\u002b08:00",
  "dateModified" : "2023-12-08T15:50:38\u002b08:00",
  "image" : "https:\/\/coosis.github.io\/img\/ClearHead2.ico",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/coosis.github.io\/posts\/ollamawithgodot\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/coosis.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/coosis.github.io\/img\/ClearHead2.ico",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Use Ollama with Godot" />
<meta property="og:description" content="What? You can have &ldquo;alive&rdquo; NPCs in your game?">
<meta property="og:image" content="https://coosis.github.io/img/ClearHead2.ico" />
<meta property="og:url" content="https://coosis.github.io/posts/ollamawithgodot/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="" />

  <meta name="twitter:title" content="Use Ollama with Godot" />
  <meta name="twitter:description" content="What? You can have &ldquo;alive&rdquo; NPCs in your game?">
  <meta name="twitter:image" content="https://coosis.github.io/img/ClearHead2.ico" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@CoosisV" />
  <meta name="twitter:creator" content="@CoosisV" />
  <link href='https://coosis.github.io/img/ClearHead2.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.139.0">
  <link rel="alternate" href="https://coosis.github.io/index.xml" type="application/rss+xml" title=""><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://coosis.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://coosis.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://coosis.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-V27ETEVEY8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-V27ETEVEY8');
        }
      </script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://coosis.github.io/"></a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="" href="https://coosis.github.io/">
            <img class="avatar-img" src="https://coosis.github.io/img/ClearHead2.ico" alt="" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Use Ollama with Godot</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>What? You can have &ldquo;alive&rdquo; NPCs in your game?</p>
<h1 id="intro-to-ollama">Intro to Ollama:</h1>
<p>I found a open source project: <a href="https://ollama.ai/">ollama</a> by jmorganca. Github page:<a href="https://github.com/jmorganca/ollama">Ollama</a>. Ollama lets you host language models and open up endpoints for other programs to use. The models are mainly open-sourced models like <a href="https://ai.meta.com/llama/">llama2</a> from <a href="https://ai.meta.com/">Meta AI</a>. Now all open-ai-privately-owns-its-models-for-profits nonsense aside, this got me very excited. Imagine a game where every NPC is able to produce dialogs by themselves, and we&rsquo;re able to have a real conversation with them. Ask about the game world, or about their lives, and get actual response. How amazing is that?</p>
<h1 id="mechanism">Mechanism:</h1>
<p>The <a href="https://github.com/jmorganca/ollama/blob/main/docs/api.md">API docs</a> at ollama site is very clear and instructive. After following it I was able to set up a model running on my macbook. Then I opened up godot. Now, to interact with the model, you send a httprequest to the endpoint with your query information using .json files, and a response will be generated back to you, in .json format. Visit <a href="https://github.com/jmorganca/ollama/blob/main/docs/api.md">API docs</a> to see list of all possible parameters in the query.</p>
<h1 id="doing-it-badly">Doing it&hellip; badly:</h1>
<p>In godot, http requests are made easy with the use of httprequest nodes. They have a signal called request_conpleted, which will emit when the http request is finished, that is, when the full response is received. This is what I did at first. I used <code>JSON.stringify()</code> to create a json object for query, send the json on the click of a button, and handled the response using something like <code>json.parse(body.get_string_from_utf8())</code>. This worked, and I was very excited about it, but it soon hit me: this is not ideal, as the response can only show when the entire process is finished. When using models like copilot chat and chatgpt and bard, the response is extended bit by bit. I wanted to achieve a similar effect. But if anyone is curious about the original code, here&rsquo;s that:</p>
<pre tabindex="0"><code>#Used when button is clicked
func legacy():
	var http_request = $HTTPRequest  # Reference to your HTTPRequest node

	var body = JSON.stringify({
		&#34;model&#34;: &#34;llama2&#34;,
		&#34;prompt&#34;: textbud.text,
		&#34;stream&#34;: false
	})
	
	http_request.request(websocket_url, [], HTTPClient.METHOD_POST, body)

#Connected to the signal mentioned
func _on_http_request_request_completed(result, response_code, headers, body):
	var json = JSON.new()
	json.parse(body.get_string_from_utf8())
	var response = json.get_data()
	print(response[&#34;response&#34;])
	lab.text = response[&#34;response&#34;]
</code></pre><h1 id="doing-it">Doing it:</h1>
<p>After looking through the documentation for godot 4, I quickly found out that using httprequest nodes is not going to cut it. The httprequest nodes are build from HTTPClient, therefore I have to implement from HTTPClient. I needed to handle connection, polling, status-checking and data-retriving. Here&rsquo;s the code:
Side note: I wrote this in the script of a HBoxContainer to make it easier to show the response.</p>
<pre tabindex="0"><code>extends HBoxContainer

@onready var textbud = $TextEdit
@onready var lab = $Label

# The URL we will connect to
var websocket_url = &#34;http://localhost:11434/api/generate&#34;
var err = 0
var client # Create the Client.
var connected = false

# Called when the node enters the scene tree for the first time.
func _ready():
	client = HTTPClient.new()
	err = client.connect_to_host(&#34;http://localhost&#34;, 11434)
	assert(err == OK)

# Called every frame. &#39;delta&#39; is the elapsed time since the previous frame.
func _process(delta):
	client.poll()
	if(client.get_status() == HTTPClient.STATUS_CONNECTING or client.get_status() == HTTPClient.STATUS_RESOLVING):
		if(!connected):
			print(&#34;Connecting...&#34;)
	elif(client.get_status() == HTTPClient.STATUS_CONNECTED):
		if(!connected):
			connected = true
			print(&#34;Connected!&#34;)
	elif(client.get_status() == HTTPClient.STATUS_DISCONNECTED):
		if(connected):
			connected = false
			print(&#34;Disconnected!&#34;)
	elif(client.get_status() == HTTPClient.STATUS_BODY):
		print(&#34;Requesting...&#34;)
		if(client.has_response()):
			var chunk = client.read_response_body_chunk()
			var jsdata = JSON.new()
			jsdata.parse(chunk.get_string_from_utf8())
			var data = jsdata.get_data()
			if(data != null):
				print(data[&#34;response&#34;])
				lab.text += data[&#34;response&#34;]

func _on_button_pressed():
	var query_string = JSON.stringify({
		&#34;model&#34;: &#34;llama2&#34;,
		&#34;prompt&#34;: textbud.text,
		&#34;stream&#34;: true
	})
	var headers = [&#34;Content-Type: application/x-www-form-urlencoded&#34;, &#34;Content-Length: &#34; + str(query_string.length())]
	var result = client.request(HTTPClient.METHOD_POST, &#34;/api/generate&#34;, [], query_string)
</code></pre><h1 id="result">Result:</h1>



<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
    
    <link rel="stylesheet" href="https://coosis.github.io/css/hugo-easy-gallery.css" />
    <div class="box" >
      <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    	<div class="img" style="background-image: url('https://coosis.github.io/posts/ollamawithgodot/res1.png');">
          <img itemprop="thumbnail" src="https://coosis.github.io/posts/ollamawithgodot/res1.png" alt="Result 1"/>
        </div>
        <a href="https://coosis.github.io/posts/ollamawithgodot/res1.png" itemprop="contentUrl"></a>
          <figcaption>
              <p>Result 1</p>
          </figcaption>
      </figure>
    </div>

    
    
    <div class="box" >
      <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    	<div class="img" style="background-image: url('https://coosis.github.io/posts/ollamawithgodot/res2.png');">
          <img itemprop="thumbnail" src="https://coosis.github.io/posts/ollamawithgodot/res2.png" alt="Result 2"/>
        </div>
        <a href="https://coosis.github.io/posts/ollamawithgodot/res2.png" itemprop="contentUrl"></a>
          <figcaption>
              <p>Result 2</p>
          </figcaption>
      </figure>
    </div>

    
    
    <div class="box" >
      <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    	<div class="img" style="background-image: url('https://coosis.github.io/posts/ollamawithgodot/res2.png');">
          <img itemprop="thumbnail" src="https://coosis.github.io/posts/ollamawithgodot/res2.png" alt="Result 3"/>
        </div>
        <a href="https://coosis.github.io/posts/ollamawithgodot/res2.png" itemprop="contentUrl"></a>
          <figcaption>
              <p>Result 3</p>
          </figcaption>
      </figure>
    </div>


</div>

        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f&amp;text=Use%20Ollama%20with%20Godot&amp;via=CoosisV" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f&amp;title=Use%20Ollama%20with%20Godot" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f&amp;title=Use%20Ollama%20with%20Godot" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f&amp;title=Use%20Ollama%20with%20Godot" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fcoosis.github.io%2fposts%2follamawithgodot%2f&amp;description=Use%20Ollama%20with%20Godot" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://coosis.github.io/posts/firsttime_neuralnetwork/" data-toggle="tooltip" data-placement="top" title="First-Time: Neural Network(overview)">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://coosis.github.io/posts/firsttime_developiosapp/" data-toggle="tooltip" data-placement="top" title="First-Time: IOS App">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:coosislee@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/Coosis" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://twitter.com/CoosisV" title="Twitter">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-x-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://telegram.me/Coosis" title="Telegram">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-telegram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://coosis.github.io/">Coosis</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.139.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://coosis.github.io/js/main.js"></script>
<script src="https://coosis.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://coosis.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

